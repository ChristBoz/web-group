<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Filter Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .genre-chip {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .genre-chip.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        .genre-chip:hover {
            background: #e0e0e0;
        }
        .genre-chip.active:hover {
            background: #5568d3;
        }
        .events-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .event-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .event-card h3 {
            margin-top: 0;
        }
        .event-genres {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        .event-genre-tag {
            background: #f0f0f0;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
        }
        .test-results {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }
        .test-results h3 {
            margin-top: 0;
        }
        .test-results code {
            background: #e0e0e0;
            padding: 2px 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>Event Filter Module Test</h1>
    
    <h2>Categories</h2>
    <div class="genre-filters">
        <div class="genre-chip active" data-category-slug="">All Events</div>
        <div class="genre-chip" data-category-slug="music">Music</div>
        <div class="genre-chip" data-category-slug="food-drink">Food & Drinks</div>
        <div class="genre-chip" data-category-slug="junkbox">Junkbox</div>
        <div class="genre-chip" data-category-slug="arts-culture">Arts &amp; Culture</div>
        <div class="genre-chip" data-category-slug="sports">Sports</div>
    </div>
    
    <h2>Events</h2>
    <div class="events-container" id="events-container">
        <!-- Music events -->
        <div class="event-card" data-event-slug="music" data-type="Music">
            <h3>Rock Concert</h3>
            <p>A great rock music event</p>
            <div class="event-genres">
                <span class="event-genre-tag">Music</span>
            </div>
        </div>
        
        <!-- Food event -->
        <div class="event-card" data-event-slug="food-drink" data-type="Food & Drinks">
            <h3>Food Festival</h3>
            <p>Amazing food and drinks</p>
            <div class="event-genres">
                <span class="event-genre-tag">Food & Drinks</span>
            </div>
        </div>
        
        <!-- Junkbox event (with variations) -->
        <div class="event-card" data-type="Junkbox">
            <h3>Junkbox Event 1</h3>
            <p>This should appear when Junkbox is selected</p>
            <div class="event-genres">
                <span class="event-genre-tag">Junkbox</span>
            </div>
        </div>
        
        <!-- Junkbox event (different case and spacing) -->
        <div class="event-card" data-type="junk box">
            <h3>Junkbox Event 2</h3>
            <p>Should also appear (different case and spacing)</p>
            <div class="event-genres">
                <span class="event-genre-tag">junk box</span>
            </div>
        </div>
        
        <!-- Multi-type event -->
        <div class="event-card" data-type="Junkbox, Music">
            <h3>Junkbox Music Night</h3>
            <p>Should appear in both Junkbox and Music categories</p>
            <div class="event-genres">
                <span class="event-genre-tag">Junkbox</span>
                <span class="event-genre-tag">Music</span>
            </div>
        </div>
        
        <!-- Arts & Culture event -->
        <div class="event-card" data-event-slug="arts-culture" data-type="Arts &amp; Culture">
            <h3>Art Exhibition</h3>
            <p>Beautiful art showcase</p>
            <div class="event-genres">
                <span class="event-genre-tag">Arts &amp; Culture</span>
            </div>
        </div>
        
        <!-- Sports event -->
        <div class="event-card" data-event-slug="sports" data-type="Sports">
            <h3>Football Match</h3>
            <p>Exciting sports event</p>
            <div class="event-genres">
                <span class="event-genre-tag">Sports</span>
            </div>
        </div>
    </div>
    
    <div class="test-results">
        <h3>Test Results</h3>
        <div id="test-output">
            <p>Click categories above to test filtering. All events should be visible initially.</p>
            <p>Test cases:</p>
            <ul>
                <li>Click "Junkbox" - should show all 3 junkbox events (including variations and multi-type)</li>
                <li>Click "Music" - should show 2 events (Rock Concert and Junkbox Music Night)</li>
                <li>Click "Food & Drinks" - should show 1 event (Food Festival)</li>
                <li>Click "Arts & Culture" - should show 1 event (Art Exhibition)</li>
                <li>Click "All Events" - should show all 7 events</li>
            </ul>
        </div>
        <div id="normalization-tests"></div>
    </div>
    
    <script src="scripts/event-filter.js"></script>
    <script>
        // Initialize the filter
        EventFilter.setup();
        
        // Run normalization tests
        const testOutput = document.getElementById('normalization-tests');
        testOutput.innerHTML = '<h4>Normalization Tests</h4>';
        
        const tests = [
            { input: 'Food & Drinks', expected: 'food and drinks' },
            { input: 'Arts  &amp;  Culture', expected: 'arts and culture' },
            { input: 'Junk Box', expected: 'junk box' },
            { input: 'MUSIC', expected: 'music' },
            { input: '  Sports  ', expected: 'sports' }
        ];
        
        tests.forEach(test => {
            const result = EventFilter._normalize(test.input);
            const passed = result === test.expected;
            testOutput.innerHTML += `
                <p style="color: ${passed ? 'green' : 'red'}">
                    ${passed ? '✓' : '✗'} 
                    <code>"${test.input}"</code> → 
                    <code>"${result}"</code> 
                    ${passed ? '' : `(expected: "${test.expected}")`}
                </p>
            `;
        });
        
        // Test type extraction
        testOutput.innerHTML += '<h4>Type Extraction Tests</h4>';
        const typeTests = [
            { input: 'Music, Concert, Festival', expected: ['music', 'concert', 'festival'] },
            { input: 'Junkbox | Music', expected: ['junkbox', 'music'] },
            { input: 'Food / Drinks', expected: ['food', 'drinks'] }
        ];
        
        typeTests.forEach(test => {
            const result = EventFilter._extractTypes(test.input);
            const passed = JSON.stringify(result) === JSON.stringify(test.expected);
            testOutput.innerHTML += `
                <p style="color: ${passed ? 'green' : 'red'}">
                    ${passed ? '✓' : '✗'} 
                    <code>"${test.input}"</code> → 
                    <code>[${result.join(', ')}]</code>
                    ${passed ? '' : `(expected: [${test.expected.join(', ')}])`}
                </p>
            `;
        });
        
        // Add event counter
        function updateEventCount() {
            const visibleEvents = document.querySelectorAll('.event-card:not([style*="display: none"])').length;
            const totalEvents = document.querySelectorAll('.event-card').length;
            document.getElementById('test-output').querySelector('p').innerHTML = 
                `Showing <strong>${visibleEvents}</strong> of <strong>${totalEvents}</strong> events`;
        }
        
        // Monitor for changes
        const observer = new MutationObserver(updateEventCount);
        document.querySelectorAll('.event-card').forEach(card => {
            observer.observe(card, { attributes: true, attributeFilter: ['style'] });
        });
        
        updateEventCount();
    </script>
</body>
</html>
